<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SVM Documentation</title>
    <style>
        body {
            width: 50%;
            margin: auto;
            background-color: whitesmoke;
        }
        .label {
            font-family: monospace;
            background-color: wheat;
            padding: 5px;
            margin-top: 30px;
        }
        .struct {
            border-collapse: collapse;
            width: 100%;
            font-family: monospace;
        }
        .struct th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: left;
        }
        .struct tr:nth-child(even) {
            background-color: rgb(236, 236, 236);
        }
        .struct tr:hover {
            background-color: rgb(255, 255, 202);
        }
    </style>
    <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
</head>
<body>
    <h1>
        Salt Virtual Machine (svm) documentation
    </h1>
    
    <hr>
    <p>
        The Salt Virtual Machine is the interpreter for compiled Salt code generated by <code>saltc</code>,
        the Salt compiler. It is written in C to have more control over the bytes and what is happening
        in the background, to achieve better execution speeds.
        <br><br>
        This is a list of what the virtual machine does before executing the code:
        <ul>
            <li>Read the 64-byte header and validate it (doc/scc.html)</li>
            <li>Load values from the header</li>
            <li>Allocate enough memory for constant strings</li>
            <li>Load bytecode from file</li>
            <li>Preload stage, find labels</li>
            <li>Allocate memory for SVM registers</li>
        </ul>

        The first thing the virtual machine does is read the header & validate it. More information about
        this stage can be found in <code>doc/scc.html</code>. After checking multiple fields and loading the
        proper values, it allocates enough memory for the constant strings and loads them. By default 
        each string should start with 4 bytes contaning the string length end and with a <code>0x0a</code>
        byte.
        <br><br>
    </p>

    <div id="s_SaltObject">
        <h2 class="label">struct SaltObject</h2>
        <p>
            The SaltObject structure type is a universal data container used everywhere
            in Salt to hold any type of data. This is achieved by leaving space for a void
            pointer, which you can then dereference to get the data.
        </p>
        <table class="struct">
            <tr>
                <th>Field</th>
                <th>Size</th>
                <th>Purpose</th>
            </tr>
            <tr>
                <td>uint id</td>
                <td>4</td>
                <td>unique ID of the object assigned by salt_id()</td>
            </tr>
            <tr>
                <td>byte type</td>
                <td>1</td>
                <td>base type of the object. should be one of SaltType_</td>
            </tr>
            <tr>
                <td>byte permission</td>
                <td>1</td>
                <td>0x00 if SVM Core created this object</td>
            </tr>
            <tr>
                <td>byte constant</td>
                <td>1</td>
                <td>0x01 if the variable is constant</td>
            </tr>
            <tr>
                <td>byte typeinfo[8]</td>
                <td>8</td>
                <td>additional information about the type</td>
            </tr>
            <tr>
                <td>void *data</td>
                <td>8</td>
                <td>pointer to the actual data</td>
            </tr>
            <tr>
                <td>uint mutex_id</td>
                <td>4</td>
                <td>ID of the mutex. if no mutex is locking this, it is set to 0x00</td>
            </tr>
            <tr>
                <td>uint scope_id</td>
                <td>4</td>
                <td>ID of the scope where the variable is visible</td>
            </tr>
        </table>
    </div>

    <footer style="height: 100px;"></footer>

</body>
</html>